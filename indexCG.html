<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoVisor</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="leaflet-measure-master/css/leaflet-measure.css">
    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="shortcut icon" href="Logo CTGlobal-icono.png">

    <style>
        body,
        html {
            /*font-family: 'Teko', sans-serif;
            font-size: 20px;
             Ajusta el peso de la fuente según necesites */
        }
        
        #map {
            height: calc(100vh - 56px);
            /* Ajusta los 56px según la altura real de tu barra de navegación */
            position: relative;
            /* Agrega esta línea */
        }
        
        .sidebar {
            overflow-y: auto;
        }
        
        .toggler-sidebar {
            cursor: pointer;
        }
        
        .navbar-brand {
            font-family: 'Teko', sans-serif;
            /* Ajusta el peso de la fuente y otros estilos según necesites */
        }
        
        .logo-left {
            margin-right: 20px;
            /* Añade un espacio a la derecha del primer logo */
        }
        
        .logo-right {
            margin-left: 20px;
            margin-right: 20px;
            /* Añade un espacio a la izquierda del segundo logo */
        }
        
        .navbar-brand {
            font-family: 'Teko', sans-serif;
            /* Si decides usar la fuente Teko */
            font-size: 25px;
            /* Tamaño de la fuente ajustado */
        }
        
        .navbar {
            background-image: linear-gradient(to bottom, #407d00, rgba(64, 125, 0, 0.7) 35%);
            /* El cambio comienza a hacerse transparente más rápidamente, alrededor del 10% del camino hacia abajo */
        }
        
        .bg-primary {
            background-color: #1e9cd7 !important;
            /* Cian */
        }
    </style>
</head>

<body>

    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <img src="logo.png" alt="Logo" class="logo logo-left" style="width: 100px; height: 100%;">
            <a class="navbar-brand" href="#">GeoVisor</a>
            <img src="Logo CTGlobal-08.png" alt="Logo" class="logo logo-right" style="width: 100px; height: 100%;">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
        </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="https://ctglobal.com.co" target="_blank">Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Sobre Nosotros</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Contáctenos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Precios</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="d-flex">
        <div class="sidebar bg-primary flex-shrink-0 p-3">
            <span class="toggler-sidebar">
                <span class="icon">㊂</span>
            <span class="menu-text text-white fs-4">Herramientas</span>
            </span>
            <ul class="nav nav-pills flex-column mb-auto">
                <li class="nav-item">
                    <a href="#" class="nav-link active" aria-current="page" id="homeLink">
                        <span class="icon">&#127968;</span>
                        <span class="text">Home</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="nav-link text-white">
                        <span class="icon">&#128202;</span>
                        <span class="text">Busqueda</span>
                    </a>
                </li>
                <!--<li>
                    <a href="#" class="nav-link text-white">
                        <span class="icon">&#128230;</span>
                        <span class="text">Informacion</span>
                    </a>
                </li>
                <li>
                -->
                <a href="#" class="nav-link text-white" id="productsLink">
                    <span class="icon">&#128717;</span>
                    <span class="text">Productos</span>
                </a>
                </li>
                <li>
                    <a href="#" class="nav-link text-white">
                        <span class="icon">&#128101;</span>
                        <span class="text">Clientes</span>
                    </a>
                </li>

            </ul>
        </div>
        <!-- Segundo sidebar con panel de búsqueda -->
        <div class="sidebar-secondary bg-secondary flex-shrink-0 p-3" id="sidebar-dashboard" style="display: none; width: 250px;">
            <!-- Panel de búsqueda -->
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12 bg-light">
                        <div class="container py-3">
                            <!-- Contenedor para la selección de capa -->
                            <div class="row mb-3">
                                <div class="col-md-12">
                                    <select class="form-select" id="Capa_layer">
                                <option selected>Seleccione un layer</option>
                                    <option value="AmenazaMovMasaCelia">Amenazas deslizamineto la Celia</option>
                                    <option value="DrenajeSencilloCelia">Drenaje la Celia</option>
                                    <option value="PrediosRuralCelia">Predios la Celia</option>
                                    <option value="ViasCelia">Vias la Celia</option>
                                    <option value="InventarioSismos">Inventarios sismos Santa Rosa de Cabal</option>
                                    <option value="RasgosEstructurales">Rasgos estructurales Santa Rosa de Cabal</option>
                                    <option value="Carto_Basica_cabecera DAgua_R">Drenaje agua Santa Rosa de Cabal</option>
                                    <option value="Carto_Basica_cabecera PerimetrosUrbanos">Perimetros Urbanos</option>
                                    <option value="UnidadGeologica">Unidad Geologica Santa Rosa de Cabal</option>
                            </select>
                                </div>
                            </div>
                            <!-- Contenedor para la selección de campo -->
                            <div class="row mb-3">
                                <div class="col-md-12">
                                    <select class="form-select" id="Campo_layer">
                                <option selected>Seleccione un campo</option>
                                
                            </select>
                                </div>
                            </div>
                            <!-- Contenedor para el input de filtro -->
                            <div class="row mb-3">
                                <div class="col-md-12">
                                    <input type="text" class="form-control" id="Filtro_Campo" placeholder="Ingrese un filtro">
                                </div>
                            </div>
                            <!-- Contenedor para los botones de acción -->
                            <div class="row">
                                <div class="col-md-12">
                                    <button type="button" class="btn btn-primary" id="MapsStreetView">Añadir un marcador</button>
                                    <button type="button" class="btn btn-secondary" id="VerStreetView" style="display: none;">Ver en Street View</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>




        <!-- Sidebar de Products, inicialmente oculto -->
        <!-- Nuevo sidebar para Products, inicialmente oculto -->

        <div class="sidebar-secondary bg-secondary flex-shrink-0 p-3" id="sidebar-products" style="display: none; width: 370px;">
            <!-- Panel de búsqueda -->
            <h2>Productos</h2>
            <!-- Contenedor para la selección de categorías -->
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">
                        <!-- La Celia -->
                        <select class="form-select mb-3" id="laCelia">
                            <option selected>La Celia</option>
                            <option value="AmenazaMovMasaCelia">Amenazas deslizamiento la Celia</option>
                                <option value="DrenajeSencilloCelia">Drenaje la Celia</option>
                                <option value="PrediosRuralCelia">Predios la Celia</option>
                                <option value="ViasCelia">Vías la Celia</option>
                        </select>


                        <!-- Ordenamiento territorial -->
                        <select class="form-select mb-3" id="ordenamientoTerritorial">
                <option selected>Ordenamiento territorial</option>
                <option value="Acueducto">Acueducto</option>
                    <option value="Alcantarillado">Alcantarillado</option>
                    <option value="AlumbradoPublico_LaCelia">Alumbrado Público La Celia</option>
                    <option value="AntenasComunicacion">Antenas de Comunicación</option>
                    <option value="Bocatoma">Bocatoma</option>
                    <option value="Cantera">Cantera</option>
                    <option value="Cascadas">Cascadas</option>
                    <option value="CasetaComunal_Rural">Caseta Comunal Rural</option>
            </select>
                        <!--   -->
                        <!-- Desastre 
                        <select class="form-select mb-3" id="desastre">
                <option selected>Desastre</option>
            </select>-->

                        <!-- Suelos 
                        <select class="form-select mb-3" id="suelos">
                <option selected>Suelos</option>
            </select>-->

                        <!-- Cobertura de la tierra con mapas básicos e imágenes 
                        <select class="form-select mb-3" id="coberturaTierra">
                <option selected>Cobertura de la tierra con mapas básicos e imágenes</option>
            </select>-->

                        <!-- Áreas de protección -->
                        <select class="form-select mb-3" id="areasProteccion">
                <option selected>Áreas de protección</option>
                
                    <option value="ConstruccionFajaProteccion">Construcción Faja Protección</option>
                    <option value="ConstruccionInformalFajaProteccion">Construcción Informal Faja Protección</option>
                    <option value="CuchillaPaisajistica">Cuchilla Paisajística</option>
                    <option value="EstructuraEcologicaPrincipal_Rural">Estructura Ecológica Principal Rural</option>
                    <option value="EstructuraEcologicaUrbana">Estructura Ecológica Urbana</option>
                    <option value="Humedal">Humedal</option>
                    <option value="RUNAP">RUNAP</option>
                    <option value="ZonaAmortiguadoraParques">Zona Amortiguadora Parques</option>
                    <option value="ZonaAmortiguadoraPNN_Tatama">Zona Amortiguadora PNN Tatama</option>
                </select>
                        </select>

                        <!-- Atmósfera climatológica y meteorológica -->
                        <select class="form-select mb-3" id="atmosferaClimatologica">
                <option selected>Atmósfera climatológica y meteorológica</option>
                    <option value="CuencaHidrografica">Cuenca Hidrográfica</option>
                    <option value="EstacionMeteorologica">Estación Meteorológica</option>
                    <option value="FajaProteccionCauce_LaCelia">Faja Protección Cauce La Celia</option>
                    <option value="FajaProteccionCauce_Rural">Faja Protección Cauce Rural</option>
                    <option value="Isoyeta">Isoyeta</option>
                    <option value="MicrocuencaAbastecedoraAcueducto">Microcuenca Abastecedora Acueducto</option>
                    <option value="VelocidadViento">Velocidad del Viento</option>
                    <option value="ZonificacionClimatica">Zonificación Climática</option>
            </select>

                        <!-- Cartografía Básica -->
                        <select class="form-select mb-3" id="cartografiaBasica">
                <option selected>Cartografía Básica</option>
                <option value="Curvas_nivel">Curvas de nivel</option>
                    <option value="Division_municipal">División municipal</option>
                    <option value="DivisionVeredal">División Veredal</option>
                    <option value="Drenaje_doble">Drenaje doble</option>
                    <option value="Drenaje_sencillo">Drenaje sencillo</option>
                    <option value="Drenajes_Doble">Drenajes Doble</option>
                    <option value="Drenajes_Sencillos">Drenajes Sencillos</option>
                    <option value="Infraestructura">Infraestructura</option>
                    <option value="Perimetro_PatioBonito">Perímetro Patio Bonito</option>
                    <option value="Perimetros">Perímetros</option>
                    <option value="Vias">Vías</option>
            </select>

                        <!-- Información geocientífica 
                        <select class="form-select mb-3" id="informacionGeocientifica">
                <option selected>Información geocientífica</option>
            </select>-->

                        <!-- Elevación 
                        <select class="form-select mb-3" id="elevacion">
                <option selected>Elevación</option>
            </select>-->
                    </div>
                </div>
            </div>


        </div>






        <!-- Nuevo sidebar para Customers, inicialmente oculto -->
        <div class="sidebar-secondary bg-secondary flex-shrink-0 p-3" id="sidebar-customers" style="display: none; width: 250px;">
            <!-- Título del Sidebar -->
            <h4>Clientes Potenciales y Aplicaciones</h4>
            <!-- Introducción -->
            <p>La capacidad de visualizar y analizar datos geográficos es esencial en diversos sectores:</p>
            <!-- Lista de Sectores y Aplicaciones -->
            <ul>
                <li><strong>Gobiernos y Organizaciones Públicas:</strong> Planificación territorial, gestión de recursos, y respuesta ante emergencias.</li>
                <li><strong>Planificadores Urbanos y Regionales:</strong> Desarrollo urbano sostenible y planificación del uso del suelo.</li>
                <li><strong>Agencias de Gestión de Emergencias:</strong> Monitoreo en tiempo real y respuestas eficientes ante desastres.</li>
                <li><strong>Sectores de Seguridad:</strong> Vigilancia, análisis de patrones y planificación estratégica para la seguridad pública.</li>
                <li><strong>Investigadores y Académicos:</strong> Apoyo a la investigación científica y al análisis territorial con herramientas de análisis espacial.</li>
                <li><strong>Empresas Privadas:</strong> Optimización de operaciones en logística, transporte, inmobiliario, y más.</li>
            </ul>
            <!-- Conclusión -->
            <p>Nuestros servicios convierten datos geográficos en decisiones inteligentes y acciones efectivas para enfrentar los desafíos del mundo moderno.</p>
        </div>

        <!-- Mapa -->
        <div id="map" class="flex-grow-1">
            <!-- Burbujas añadidas aquí dentro para que se posicionen sobre el mapa 
            <div class="map-bubbles">
                <div class="bubble" data-target="#window1">Medir</div>
                <div class="bubble" data-target="#window2">Burbuja 2</div>
                <div class="bubble" data-target="#window3">Burbuja 3</div>
            </div>
            -->
        </div>

        <!-- Ventanas modales para cada burbuja 
        <div id="window1" class="modal-window">Contenido ventana 1</div>
        <div id="window2" class="modal-window">Contenido ventana 2</div>
        <div id="window3" class="modal-window">Contenido ventana 3</div>
        -->

    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="leaflet-measure-master/src/leaflet-measure.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="./Leaflet.MousePosition-master/src/L.Control.MousePosition.js"></script>

    <!--Estas dos src son de wfs no borrar nada-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="./leaflet-geoserver-request-master/leaflet-geoserver-request-master/src/L.Geoserver.js"></script>
    <style>
        /* Ajusta el ancho original y el contraído del sidebar */
        
        .sidebar {
            width: 250px;
            /* Ancho original del sidebar */
            transition: width 0.3s;
        }
        
        .sidebar-contracted {
            width: 100px;
            /* Ancho cuando está contraído */
        }
        /* Estilo para el texto y los íconos dentro de los enlaces */
        
        .nav-link .text {
            display: inline;
            /* Asegura que el texto se muestre inicialmente */
        }
        
        .nav-link .icon {
            margin-right: 10px;
            /* Espaciado entre ícono y texto, si ambos se muestran */
        }
        /* Oculta el texto y ajusta los íconos cuando el sidebar está contraído */
        
        .sidebar-contracted .nav-link .text {
            display: none;
            /* Oculta el texto */
        }
        
        .sidebar-contracted .nav-link {
            justify-content: center;
            /* Centra los íconos en el sidebar contraído */
        }
        
        .bg-secondary {
            background-color: #efefef!important;
            width: 250px;
            /* Ajusta el ancho según sea necesario */
            max-height: 90vh;
            /* Máxima altura igual a la altura de la ventana del navegador */
            overflow-y: auto;
            /* Permite desplazarse verticalmente si el contenido excede la altura */
            top: 0;
            /* Alinea la parte superior del sidebar con la parte superior de la ventana */
            /* Puedes ajustar la propiedad 'left' o 'right' según donde quieras que aparezca el sidebar */
        }
        
        .map-bubbles {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            /* Espacio entre burbujas */
            z-index: 1000;
            /* Asegura que las burbujas se muestren sobre el mapa */
        }
        
        .bubble {
            background-color: #007bff;
            color: white;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .modal-window {
            display: none;
            /* Ocultas inicialmente */
            position: fixed;
            left: 50%;
            bottom: 100px;
            /* Ajusta según necesites */
            transform: translateX(-50%);
            background-color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
            border-radius: 8px;
            z-index: 1000;
            /* Asegúrate de que esté sobre el mapa */
        }
        
        .sidebar-contracted .menu-icon {
            display: inline-block;
            /* Muestra el icono cuando el sidebar está contraído */
        }
        
        .sidebar-contracted .menu-text {
            display: none;
            /* Oculta el texto "Herramientas" cuando el sidebar está contraído */
        }
        
        .sidebar-secondary {
            width: 500px;
            /* Ancho del sidebar de Products */
            display: none;
            /* Oculto inicialmente */
        }
    </style>
    <script>
        var map = L.map('map').setView([5.0019444444444, -76.003888888889], 15);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        // Sidebar toggle functionality
        $('.toggler-sidebar').click(function() {
            $('.sidebar').toggleClass('sidebar-contracted');
            // Ajusta el tamaño del mapa de manera dinámica si es necesario
            map.invalidateSize();
        });

        // Codigo de medicion 

        var measureControl = new L.Control.Measure({
            position: 'bottomright',
            primaryLengthUnit: 'meters',
            secondaryLengthUnit: 'kilometers',
            primaryAreaUnit: 'sqmeters',
            secondaryAreaUnit: 'hectares',
            // Puedes cambiar la posición según necesites
            // Configuración adicional aquí
        });
        //Añadir el medidor si no se llama con otros elementos
        //measureControl.addTo(map);


        // codigo de gogle maps
        var marker = null; // Variable para almacenar el marcador
        var isAddingMarkerEnabled = false; // Variable para controlar si se permite agregar un marcador o no

        // Función para manejar el clic en el mapa y agregar un marcador
        function onMapClick(e) {
            if (marker) {
                map.removeLayer(marker); // Eliminar el marcador anterior si existe
            }
            marker = L.marker(e.latlng).addTo(map); // Agregar un nuevo marcador en la posición clicada
            // Mostrar el botón para ver en Street View
            document.getElementById("VerStreetView").style.display = "inline";
        }

        // Obtener el botón por su ID
        var botonMapsStreetView = document.getElementById("MapsStreetView");

        // Agregar un event listener para el evento de clic en el botón "Añadir un marcador"
        botonMapsStreetView.addEventListener("click", function() {
            // Alternar la variable que controla si se permite agregar un marcador o no
            isAddingMarkerEnabled = !isAddingMarkerEnabled;
            if (isAddingMarkerEnabled) {
                // Si se habilita la opción de agregar marcador, se agrega el event listener al mapa
                map.on('click', onMapClick);
            } else {
                // Si se deshabilita la opción de agregar marcador, se quita el event listener del mapa
                map.off('click', onMapClick);
            }
        });

        // Obtener el botón por su ID
        var botonVerStreetView = document.getElementById("VerStreetView");

        // Agregar un event listener para el evento de clic en el botón "Ver en Street View"
        botonVerStreetView.addEventListener("click", function() {
            // Obtener las coordenadas del marcador
            var latitud = marker.getLatLng().lat;
            var longitud = marker.getLatLng().lng;

            // Abrir Google Street View con las coordenadas del marcador
            abrirGoogleStreetView(latitud, longitud);
        });

        function abrirGoogleStreetView(latitud, longitud) {
            // Construir la URL de Google Street View con las coordenadas proporcionadas
            var url = "https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=" + latitud + "," + longitud;

            // Abrir una nueva pestaña del navegador con la URL de Google Street View
            window.open(url, "_blank");
        }

        // codigo de buscador dinamico
        var filter = "";
        var fields = "";
        var search = "";
        var wfsLayer;

        // Función para actualizar el estado y realizar acciones adicionales
        function updateFilter(value) {
            filter = value;
            updateDisplay();
        }

        function updateFields(value) {
            fields = value;
            updateDisplay();
        }

        function updateSearch(value) {
            search = value;
            updateDisplay();
        }

        function updateDisplay() {
            //  console.log(wfsLayer)
            // Elimina la capa existente antes de agregar la nueva
            if (wfsLayer) {
                map.removeLayer(wfsLayer);
                controlCapas.removeLayer(wfsLayer);
            }

            wfsLayer = L.Geoserver.wfs("http://localhost:8081/geoserver/wfs", {
                layers: `Manizales:${filter}`,
                style: {
                    color: "blue",
                    fillOpacity: "0",
                    opacity: "0.5",
                },
                onEachFeature: function(feature, layer) {
                    const diccionario = layer.feature.properties
                    featureArray = Object.keys(diccionario)
                    var selectOption = document.getElementById("Campo_layer");
                    selectOption.innerHTML = "";

                    const popupContent = generatePopupContent(feature);
                    layer.bindPopup(popupContent);

                    featureArray.forEach((featureArray) => {
                        // Crea un nuevo elemento option
                        const newOption = document.createElement("option");
                        newOption.value = featureArray;
                        newOption.text = featureArray;

                        // Añade el nuevo elemento option al elemento select
                        selectOption.appendChild(newOption);
                    });


                    //layer.bindPopup("Este layer tiene la información altura de : " + feature.properties.CNAltura + " y su numero de objeto es : " + feature.properties.OBJECTID);
                },
                CQL_FILTER: fields == "" ? "" : `${fields}=='${search}'`,
            });
            wfsLayer.addTo(map);
            controlCapas.addOverlay(wfsLayer, "WFS Layer")
        }

        // Agregar event listeners
        document.getElementById("Capa_layer").addEventListener("change", function(event) {
            updateFilter(event.target.value);
        });

        document.getElementById("Campo_layer").addEventListener("change", function(event) {
            updateFields(event.target.value);
        });

        document.getElementById("Filtro_Campo").addEventListener("input", function(event) {
            updateSearch(event.target.value);
        });


        function generatePopupContent(feature) {
            const properties = feature.properties;
            const popupContent = [];

            // Agregar las propiedades al contenido del popup
            for (const prop in properties) {
                if (properties.hasOwnProperty(prop)) {
                    popupContent.push(`<b>${prop}:</b> ${properties[prop]}`);
                }
            }

            // Puedes personalizar la presentación del contenido según tus necesidades
            // Simplemente se concatena todo en un string
            return popupContent.join('<br>');
        }

        var osm = new L.TileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(map);

        //var EsriMap = L.tileLayer.provider('Esri.WorldGrayCanvas');

        //var sateliteMap = L.tileLayer.provider('Esri.WorldImagery');

        /*
                var wmsGeneralCab = L.tileLayer.wms("http://127.0.0.1:8081/geoserver/Manizales/wms?", {
                        layers: ["Manizales:Carto_Basica_cabecera CNivel"],
                        format: 'image/png',
                        transparent: true
                    }) //.addTo(map);
        */
        // definir una capa con wfs con todas sus capacidades
        var wfsLayer = L.Geoserver.wfs("http://localhost:8081/geoserver/wfs", {
            layers: `Manizales:Carto_Basica_cabecera Drenaj_L`,
            style: {
                color: "black",
                fillOpacity: "0",
                opacity: "0.5",
            },
            onEachFeature: function(feature, layer) {
                layer.bindPopup("Este layer tiene la información altura de : " + feature.properties.CNAltura + " y su numero de objeto es : " + feature.properties.OBJECTID);
            },
            //CQL_FILTER: "district='Syangja'",
        });
        //wfsLayer.addTo(map);

        //Carga de todos los layers wms 


        var wmsGeneralCurv = L.tileLayer.wms("http://127.0.0.1:8081/geoserver/Manizales/wms?", {
                layers: ["Manizales:Carto_Basica_cabecera CNivel"],
                format: 'image/png',
                transparent: true
            }) //.addTo(map);

        var wmsGeneralCurv1m = L.tileLayer.wms("http://127.0.0.1:8081/geoserver/Manizales/wms?", {
            layers: ["Manizales:Carto_Basica_cabecera CNivel_1m"],
            format: 'image/png',
            transparent: true
        });

        var wmsCabeceraCartoBasica = L.tileLayer.wms("http://127.0.0.1:8081/geoserver/Manizales/wms?", {
                layers: ["Manizales:Carto_Basica_cabecera Constr_R"],
                format: 'image/png',
                transparent: true
            }) //.addTo(map);

        var wmsCabeceraCartoDAgua = L.tileLayer.wms("http://127.0.0.1:8081/geoserver/Manizales/wms?", {
                layers: ["Manizales:Carto_Basica_cabecera DAgua_R"],
                format: 'image/png',
                transparent: true
            }) //.addTo(map);

        var wmsCabeceraCartoDrenajeEtiqueta = L.tileLayer.wms("http://127.0.0.1:8081/geoserver/Manizales/wms?", {
                layers: ["Manizales:Carto_Basica_cabecera Drenaj_Etiqueta"],
                format: 'image/png',
                transparent: true
            }) //.addTo(map);

        var wmsCabeceraBasicaDrenajeL = L.tileLayer.wms("http://127.0.0.1:8081/geoserver/Manizales/wms?", {
            layers: ["Manizales:Carto_Basica_cabecera Drenaj_L"],
            format: 'image/png',
            transparent: true
        });

        var wmsCabeceraBasicaDrenajeR = L.tileLayer.wms("http://127.0.0.1:8081/geoserver/Manizales/wms?", {
            layers: ["Manizales:Carto_Basica_cabecera Drenaj_R"],
            format: 'image/png',
            transparent: true
        });
        var wmsUnidadGeologica = L.tileLayer.wms("http://127.0.0.1:8081/geoserver/Manizales/wms?", {
                layers: ["Manizales:UnidadGeologica"],
                format: 'image/png',
                transparent: true
            }) //.addTo(map);


        // La Celia 

        var wmsAmenazaMovMasaCelia = L.tileLayer.wms("http://127.0.0.1:8081/geoserver/Manizales/wms?", {
                layers: ["Manizales:AmenazaMovMasaCelia"],
                format: 'image/png',
                transparent: true
            }) //.addTo(map);
        var wmsDrenajeSencilloCelia = L.tileLayer.wms("http://127.0.0.1:8081/geoserver/Manizales/wms?", {
                layers: ["Manizales:DrenajeSencilloCelia"],
                format: 'image/png',
                transparent: true
            }) //.addTo(map);
        var wmsPrediosRuralCelia = L.tileLayer.wms("http://127.0.0.1:8081/geoserver/Manizales/wms?", {
                layers: ["Manizales:PrediosRuralCelia"],
                format: 'image/png',
                transparent: true
            }) //.addTo(map);
        var wmsViasCelia = L.tileLayer.wms("http://127.0.0.1:8081/geoserver/Manizales/wms?", {
                layers: ["Manizales:ViasCelia"],
                format: 'image/png',
                transparent: true
            }) //.addTo(map);




        // prueba de subir shape y editar en arcgis 
        var wmsMundo = L.tileLayer.wms("http://127.0.0.1:8081/geoserver/Manizales/wfs?", {
            layers: ["Manizales:Paises_Mundo_export"],
            format: 'image/png',
            transparent: true
        }).addTo(map);


        // definir las capas base que se pueden seleccionar
        var osmHOT = L.tileLayer('https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '© OpenStreetMap contributors, Tiles style by Humanitarian OpenStreetMap Team hosted by OpenStreetMap France'
        });

        // Objeto de capas base
        var capasBase = {
            "Mapa Base": osm,
            "Mapa Topografico": osmHOT,
        };

        var capasLayer = {
            /* "Curvas de nivel 1 m": wmsGeneralCurv1m,
            "Curvas de nivel    ": wmsGeneralCurv,
            "Drenajes           ": wmsCabeceraCartoDAgua,
            "Drenajes rurales   ": wmsCabeceraCartoDrenajeEtiqueta,
            "Drenajes limites   ": wmsCabeceraBasicaDrenajeL,
            "Drenajes urbano    ": wmsCabeceraBasicaDrenajeR,
            "Unidad geologica   ": wmsUnidadGeologica,
*/
        };

        // Crear control de capas
        var controlCapas = L.control.layers(capasBase, null, {

        });
        controlCapas.addTo(map);

        var controlLayer = L.control.layers(null, null, {

        });

        // Añadir controlLayer al mapa
        //controlLayer.addTo(map);

        //Controlar leyenda
        var legend = L.control({
            position: 'bottomright'
        });

        legend.onAdd = function(map) {
            var div = L.DomUtil.create('div', 'info legend');
            return div;
        };
        //legend.addTo(map);
        // Agregar capas a controlLayer
        for (var key in capasLayer) {
            if (capasLayer.hasOwnProperty(key)) {
                controlCapas.addOverlay(capasLayer[key], key);
                capasLayer[key].on('add', function(event) {
                    var capaAgregada = event.target;
                    activarLeyenda(capaAgregada);
                });
                capasLayer[key].on('remove', function(event) {
                    // Llamamos a la función quitarLeyenda cuando la capa se quita
                    quitarLeyenda();
                });
            }
        }
        /*
                function activarLeyenda(capa) {
                    // Implementa lógica para activar la leyenda basada en la capa
                    console.log('Activar leyenda para la capa:', capa.options.layers);

                    // Actualiza el contenido de la leyenda según la capa
                    //var div = legend.getContainer();
                    //div.innerHTML = '<img alt="legend" src=" http://localhost:8081/geoserver/wms?REQUEST=GetLegendGraphic&VERSION=1.0.0&FORMAT=image/png&WIDTH=20&HEIGHT=20&LAYER=' + capa.options.layers + '" width="127" height="120" />';
                }

                function quitarLeyenda() {
                    // Quita el control de la leyenda
                    if (legend) {
                        legend.remove(map);
                    }
                }
        */
        // Definir las capas Tiff
        var Tiff1 = L.tileLayer.wms("http://127.0.0.1:8081/geoserver/Manizales/wms?", {
            layers: ["Manizales:LC08_L1TP_009057_20231203_20231209_02_T1"],
            format: 'image/png',
            transparent: true,
            //opacity: 0.5
        });

        var Tiff2 = L.tileLayer.wms("http://127.0.0.1:8081/geoserver/Manizales/wms?", {
            layers: ["Manizales:LC08_L1TP_009057_20231203_20231209_02_T1_refl"],
            format: 'image/png',
            transparent: true,
            //opacity: 0.5
        });

        var Tiff3 = L.tileLayer.wms("http://127.0.0.1:8081/geoserver/Manizales/wms?", {
            layers: ["Manizales:Ortofoto_La_Celia_3115"],
            format: 'image/png',
            transparent: true,
            //opacity: 0.5
            maxZoom: 22
        });



        // Crear un objeto con las capas Tiff
        var capasTiff = {
            "Imagen satelital F/C": Tiff1,
            "Imagen satelital V/C": Tiff2,
            "Ortofoto La Celia": Tiff3
        };

        // Crear el control de capas
        var controlCapas = L.control.layers(null, capasTiff, {
            //collapsed: false
        });

        // Añadir el control al mapa
        controlCapas.addTo(map);

        // leyenda 
        /*
                var layerrequest = L.Geoserver.legend("http://127.0.0.1:8081/geoserver/Manizales/wms", {
                    layers: "Manizales:UnidadGeologica",
                }).addTo(map);
        */
        // Escala y coordenadas
        L.control.scale({
            metric: true,
            imperial: false,
            position: 'bottomright'
        }).addTo(map);
        L.control.mousePosition().addTo(map)
    </script>
    <script>
        $(document).ready(function() {
            $('.bubble').click(function() {
                var targetId = $(this).data('target');
                var $target = $(targetId);

                // Si la ventana ya está visible, la oculta. Si no, la muestra.
                if ($target.is(':visible')) {
                    $target.hide();
                } else {
                    // Oculta otras ventanas antes de mostrar la seleccionada
                    $('.modal-window').hide();
                    $target.show();
                }
            });
        });

        document.addEventListener('DOMContentLoaded', function() {
            var measureControl = new L.Control.Measure({
                position: 'bottomright',
                primaryLengthUnit: 'meters',
                secondaryLengthUnit: 'kilometers',
                primaryAreaUnit: 'sqmeters',
                secondaryAreaUnit: 'hectares',
            }).addTo(map);

            // Esperar a que el mapa se cargue para ajustar la posición del control de medida
            map.on('load', function() {
                var measureControlDiv = document.querySelector('.leaflet-control-measure');
                if (measureControlDiv) {
                    // Establece estilos personalizados para centrar el control
                    measureControlDiv.style.position = 'relative';
                    measureControlDiv.style.left = '50%';
                    measureControlDiv.style.bottom = '10px'; // Ajusta según sea necesario
                    measureControlDiv.style.transform = 'translateX(-50%)';
                }
            });
        });

        // cuando da clik en home vuelve a unas coordenadas iniciales 
        document.addEventListener('DOMContentLoaded', function() {
            // Definir las coordenadas iniciales y el nivel de zoom del mapa
            var initialCoordinates = [5.0019444444444, -76.003888888889]; // Estas son Celia
            var initialZoomLevel = 15;

            // Añadir evento de clic al enlace "Home" usando su ID
            document.getElementById('homeLink').addEventListener('click', function(e) {
                e.preventDefault(); // Prevenir el comportamiento predeterminado del enlace
                // Restablecer la vista del mapa a las coordenadas y zoom iniciales
                map.setView(initialCoordinates, initialZoomLevel);
            });
        });

        // script dashboards y products
        $(document).ready(function() {
            // Controlador de clics para el enlace "Dashboard"
            $('.nav-link').click(function() {
                var text = $(this).find('.text').text();
                if (text === 'Busqueda') {
                    // Alternar la visibilidad del sidebar de Dashboard
                    $('#sidebar-dashboard').toggle();
                }
            });

            // Controlador de clics para el enlace "Products"
            $('.nav-link').click(function() {
                var text = $(this).find('.text').text();
                if (text === 'Productos') {
                    // Alternar la visibilidad del sidebar de Products
                    $('#sidebar-products').toggle();
                }
            });

            // Controlador de clics para el enlace "Customers"
            $('a.nav-link').click(function() {
                var text = $(this).find('.text').text();
                if (text === 'Clientes') {
                    // Alternar la visibilidad del sidebar de Customers
                    $('#sidebar-customers').toggle();
                }
            });
        });






        // Variable global para mantener un registro de la capa WMS actualmente visible
        var currentWmsLayer = null;
        var wmsLayers = {};
        var wfsLayers = {};
        // seleccionar las capas en productos activar y desactivar su visualizacion 
        // Función para actualizar el estado y realizar acciones adicionales
        function updateFeature(value) {
            search = value;
            updateVisualizationFeature();
        }

        // funcion para hacer las operaciones 
        function updateVisualizationFeature(layerName) {
            console.log(layerName)
                // Si la capa ya está en el mapa, la remueve

            if (wmsLayers[layerName]) {
                map.removeLayer(wmsLayers[layerName]);
                wmsLayers[layerName] = null; // Limpiar la referencia
            } else {
                // Si la capa no está en el mapa, la crea y la agrega
                wmsLayers[layerName] = L.tileLayer.wms("http://127.0.0.1:8081/geoserver/Manizales/wms?", {
                    layers: `Manizales:${layerName}`,
                    format: 'image/png',
                    transparent: true
                });
                wmsLayers[layerName].addTo(map);
            }
            /*
                        if (wfsLayers[layerName]) {
                            map.removeLayer(wfsLayers[layerName]);
                            wfsLayers[layerName] = null; // Limpiar la referencia
                        } else {
                            // Añade la capa WFS si no está en el mapa
                            wfsLayers[layerName] = L.Geoserver.wfs("http://localhost:8081/geoserver/wfs", {
                                layers: `Manizales:${layerName}`,
                                style: {
                                    
                                                            color: "blue",
                                                            fillOpacity: "0",
                                                            opacity: "0.5",
                                                            
                                    color: "transparent", // Esto hará que la línea sea transparente
                                    weight: "0", // Esto hará que la línea no tenga grosor
                                    opacity: "0", // Esto hará que la línea sea completamente opaca
                                    fill: false // Esto asegura que no hay relleno
                                },
                                onEachFeature: function(feature, layer) {
                                    const diccionario = layer.feature.properties
                                    featureArray = Object.keys(diccionario)
                                    var selectOption = document.getElementById("Campo_layer");
                                    selectOption.innerHTML = "";

                                    const popupContent = generatePopupContent(feature);
                                    layer.bindPopup(popupContent);

                                }
                            }).addTo(map);
                        }*/

        }





        // Función para agregar una capa WMS al mapa
        function addWmsLayer(layerName) {

        }

        // Event listener para la selección de capas de La Celia
        document.getElementById("laCelia").addEventListener("change", function(event) {
            // Obtiene el valor del layer seleccionado
            var layerName = event.target.value;

            // Llama a la función para agregar o remover la capa WMS
            updateVisualizationFeature(layerName);
        });
    </script>
</body>

</html>